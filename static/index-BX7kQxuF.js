import{i as P,_ as B}from"./index-D604ZND0.js";import{b as h,B as F}from"./element-CaKE2_v0.js";import{m as w,r as c,f as U,c as $,ai as n,p as S,q as _,U as t,O as r,F as N,a8 as T,S as m,T as k}from"./vue-whfKlJIt.js";import"./vxe-HN9Qqgrb.js";const L=w({name:"Service",setup(){const e=c([]),a=c(1),D=c(10),v=c(!1),g=c("新增服务"),u=c({name:"",namespace:"default",labels:{},type:"ClusterIP",ports:[{protocol:"TCP",port:80,targetPort:80}]}),s=U(()=>{const l=(a.value-1)*D.value,b=l+D.value;return e.value.slice(l,b)}),f=async()=>{try{const l=await P({url:"/apis/v1/k8s/services",method:"get",baseURL:"http://localhost:8080"});e.value=l}catch(l){console.error("获取服务数据失败:",l)}},d=l=>{a.value=l},V=()=>{g.value="新增服务",u.value={name:"",namespace:"default",labels:{},type:"ClusterIP",ports:[{protocol:"TCP",port:80,targetPort:80}]},v.value=!0},y=l=>{g.value="编辑服务",u.value=JSON.parse(JSON.stringify(l)),v.value=!0},p=async()=>{try{g.value==="新增服务"?(await P({url:"/apis/v1/k8s/services",method:"post",data:u.value,baseURL:"http://localhost:8080"}),h.success("服务新增成功")):(await P({url:`/apis/v1/k8s/services/${u.value.name}`,method:"put",data:u.value,baseURL:"http://localhost:8080"}),h.success("服务编辑成功")),v.value=!1,f()}catch(l){console.error("保存服务失败:",l),h.error("保存服务失败")}},i=l=>{F.confirm(`确定删除服务 ${l.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await P({url:`/apis/v1/k8s/services/${l.name}`,method:"delete",baseURL:"http://localhost:8080"}),h.success("服务删除成功"),f()}catch(b){console.error("删除服务失败:",b),h.error("删除服务失败")}})};return $(()=>{f()}),{serviceData:e,currentPage:a,pageSize:D,currentPageData:s,handlePageChange:d,dialogVisible:v,dialogTitle:g,currentService:u,handleAdd:V,handleEdit:y,handleSave:p,handleDelete:i}}});function I(e,a,D,v,g,u){const s=n("el-table-column"),f=n("el-tag"),d=n("el-button"),V=n("el-table"),y=n("el-pagination"),p=n("el-input"),i=n("el-form-item"),l=n("el-option"),b=n("el-select"),E=n("el-form"),A=n("el-dialog");return S(),_("div",null,[t(V,{data:e.currentPageData,border:"",stripe:"",style:{width:"100%"}},{default:r(()=>[t(s,{prop:"name",label:"服务名称",width:"180"}),t(s,{prop:"namespace",label:"命名空间",width:"180"}),t(s,{prop:"type",label:"服务类型",width:"180"}),t(s,{prop:"ports",label:"端口",width:"300"},{default:r(({row:o})=>[(S(!0),_(N,null,T(o.ports,C=>(S(),_("div",{key:C.port,class:"port-tag"},[t(f,null,{default:r(()=>[m(k(C.port)+":"+k(C.targetPort),1)]),_:2},1024)]))),128))]),_:1}),t(s,{label:"操作",width:"200"},{default:r(({row:o})=>[t(d,{type:"primary",onClick:C=>e.handleEdit(o)},{default:r(()=>[m("编辑")]),_:2},1032,["onClick"]),t(d,{type:"danger",onClick:C=>e.handleDelete(o)},{default:r(()=>[m("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(y,{currentPage:e.currentPage,"onUpdate:currentPage":a[0]||(a[0]=o=>e.currentPage=o),"page-size":e.pageSize,total:e.serviceData.length,layout:"total, prev, pager, next, jumper",onCurrentChange:e.handlePageChange},null,8,["currentPage","page-size","total","onCurrentChange"]),t(A,{title:e.dialogTitle,modelValue:e.dialogVisible,"onUpdate:modelValue":a[7]||(a[7]=o=>e.dialogVisible=o)},{footer:r(()=>[t(d,{onClick:a[6]||(a[6]=o=>e.dialogVisible=!1)},{default:r(()=>[m("取消")]),_:1}),t(d,{type:"primary",onClick:e.handleSave},{default:r(()=>[m("保存")]),_:1},8,["onClick"])]),default:r(()=>[t(E,{model:e.currentService,"label-width":"120px"},{default:r(()=>[t(i,{label:"服务名称"},{default:r(()=>[t(p,{modelValue:e.currentService.name,"onUpdate:modelValue":a[1]||(a[1]=o=>e.currentService.name=o)},null,8,["modelValue"])]),_:1}),t(i,{label:"命名空间"},{default:r(()=>[t(p,{modelValue:e.currentService.namespace,"onUpdate:modelValue":a[2]||(a[2]=o=>e.currentService.namespace=o)},null,8,["modelValue"])]),_:1}),t(i,{label:"服务类型"},{default:r(()=>[t(b,{modelValue:e.currentService.type,"onUpdate:modelValue":a[3]||(a[3]=o=>e.currentService.type=o)},{default:r(()=>[t(l,{label:"ClusterIP",value:"ClusterIP"}),t(l,{label:"NodePort",value:"NodePort"}),t(l,{label:"LoadBalancer",value:"LoadBalancer"}),t(l,{label:"ExternalName",value:"ExternalName"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"端口"},{default:r(()=>[t(p,{modelValue:e.currentService.ports[0].port,"onUpdate:modelValue":a[4]||(a[4]=o=>e.currentService.ports[0].port=o)},null,8,["modelValue"])]),_:1}),t(i,{label:"目标端口"},{default:r(()=>[t(p,{modelValue:e.currentService.ports[0].targetPort,"onUpdate:modelValue":a[5]||(a[5]=o=>e.currentService.ports[0].targetPort=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(d,{type:"success",onClick:e.handleAdd},{default:r(()=>[m("新增服务")]),_:1},8,["onClick"])])}const q=B(L,[["render",I],["__scopeId","data-v-8b3b8bf7"]]);export{q as default};
